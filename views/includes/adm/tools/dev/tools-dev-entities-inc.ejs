<div class="tab-pane show active mt-3" id="entities" role="tabpanel" aria-labelledby="entities-tab">

    <p>Representam pessoas, produtos, e demais <strong>entidades</strong> identificadas em seu <strong>modelo de negócio</strong></p>

    <% if(err){ let error=payload.err; // flush %>

        <script> alert('Erro', '<%=error%>', 'danger')</script>

        <% } else { // flush %>
            <div class="flex-column">
                <button class="form-control btn btn-lg btn-success mt-2" id="createentity"><i
                        class="bi bi-box"></i>&nbsp;&nbsp;Criar Entidade</button>
            </div>
            <div class="flex-column mt-3">
                <div class="alert alert-warning alert-dismissible show" role="alert">
                    <spam class="spinner-grow spinner-grow-sm text-danger" role="status"></spam> entidades não construídas, clique na entidade para informações
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <div class="table table-responsive">
                    <hr>
                    <table class="table table-striped table-hover">
                        <thead>
                            <th>Entidade</th>
                            <th>json</th>
                            <th class="text-center">crdate</th>
                        </thead>
                        <tbody>

                            <% entities=payload.entities; for(let entity in entities){ // flush %>

                                <tr class="tr-<%=entities[entity].name%>">
                                    <td class="td-<%=entities[entity].name%> td-name">
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#build-entity" data-persona360-entity="<%=entities[entity].name%>"
                                            class="btn btn-sm btn-outline-secondary entity-name entity-<%=entities[entity].name%>" id="a-<%=entities[entity].name%>"><i class="bi bi-box"></i>&nbsp;&nbsp;<%=entities[entity].name.toUpperCase()%></a>
                                    </td>
                                    <td class="td-<%=entities[entity].name%> td-json">
                                        /config/entities/<%=entities[entity].json%>
                                    </td>
                                    <td class="td-<%=entities[entity].name%> td-crdate">
                                        <div class="text-center">
                                            <div class="spinner-grow spinner-grow-sm text-danger" role="status">
                                                <span class="visually-hidden">Checando...</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>

                                <% }; // flush %>

                        </tbody>
                    </table>

                    <% }; // flush %>

                </div>
                
                <div class="modal" id="build-entity" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="build-entityLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable modal-xl">
                        <div class="modal-content">
                            <div class="modal-header text-white bg-primary">
                                <spam class="fw-light"><i class="bi bi-box"></i>&nbsp;&nbsp;Entidade <spam class="modal-title fw-bolder" id="build-entityLabel"></spam></spam>
                            </div>
                            <div class="modal-body">

                                <nav>
                                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                        <button class="nav-link active" id="nav-namespace-tab" data-bs-toggle="tab" data-bs-target="#nav-namespace" type="button"
                                            role="tab" aria-controls="nav-namespace" aria-selected="true"><i class="bi bi-info-circle"></i>&nbsp;&nbsp;Identificação</button>
                                        <button class="nav-link" id="nav-fields-tab" data-bs-toggle="tab" data-bs-target="#nav-fields" type="button"
                                            role="tab" aria-controls="nav-fields" aria-selected="false"><i class="bi bi-card-list"></i>&nbsp;&nbsp;Campos</button>
                                        <button class="nav-link" id="nav-form-tab" data-bs-toggle="tab" data-bs-target="#nav-form" type="button"
                                            role="tab" aria-controls="nav-form" aria-selected="false"><i class="bi bi-ui-checks"></i>&nbsp;&nbsp;Formulário</button>
                                            <button class="nav-link" id="nav-build-tab" data-bs-toggle="tab" data-bs-target="#nav-build" type="button" role="tab"
                                                aria-controls="nav-build" aria-selected="false"><i class="bi bi-play-circle"></i>&nbsp;&nbsp;Construir
                                                    <div class="spinner-grow spinner-grow-sm text-danger" role="status"></div>
                                                </button>
                                    </div>
                                </nav>
                                <div class="tab-content mt-3" id="nav-tabContent">
                                    <div class="tab-pane show active" id="nav-namespace" role="tabpanel" aria-labelledby="nav-namespace-tab">

                                        <form>
                                            <div class="mb-3">
                                                <label for="entity-name" class="col-form-label fw-bolder">Name&nbsp;&nbsp;<spam class="fw-light text-danger"><small><i class="bi bi-exclamation-circle"></i>&nbsp;nome único em todo sistema</small></spam></label>
                                                <input type="text" class="form-control" id="entity-name" disabled>
                                            </div>
                                            <div class="mb-3">
                                                <label for="namespace-text" class="col-form-label fw-bolder">Namespace&nbsp;&nbsp;<spam class="fw-light text-danger"><small><i class="bi bi-exclamation-circle"></i>&nbsp;nomes das campos separados por virgulas, exemplo: email, celular, genero</small></spam></label>
                                                <textarea class="form-control" id="namespace-text" disabled></textarea>
                                            </div>
                                        </form>

                                    </div>

                                    <div class="tab-pane" id="nav-fields" role="tabpanel" aria-labelledby="nav-fields-tab">

                                        <p>Campos</p>

                                    </div>
                                    <div class="tab-pane" id="nav-form" role="tabpanel" aria-labelledby="nav-form-tab">

                                        <p>Formulário</p>

                                    </div>
                                    <div class="tab-pane" id="nav-build" role="tabpanel" aria-labelledby="nav-build-tab">
                                    
                                        <p>Construir</p>
                                    
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i>&nbsp;&nbsp;Fechar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <script>

                    var buildEntity = document.getElementById('build-entity')
                        buildEntity.addEventListener('show.bs.modal', function (event) {
                            // Button that triggered the modal
                            var button = event.relatedTarget
                            // Extract info from data-bs-* attributes
                            var entity = button.getAttribute('data-persona360-entity')
                            // If necessary, you could initiate an AJAX request here
                            // and then do the updating in a callback.
                            //
                            // Update the modal's content.
                            var modalTitle = buildEntity.querySelector('.modal-title')
                            var modalBodyInput = buildEntity.querySelector('.modal-body input')

                            modalTitle.textContent = entity.toUpperCase()
                            modalBodyInput.value = entity
                        })

                </script>

            </div>
</div>
<% // flush views/includes/entities-inc.ejs into views/includes/dev-inc.ejs %>