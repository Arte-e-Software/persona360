<%-include ../../blocks/modal-full.ejs %>
    <% if(err){ let error=payload.err; // flush %>
        <script> alert('Erro', '<%=error%>', 'danger')</script>
        <% } else { // flush %>
            <div class="container">
                <h3>Entidades</h3>
                <hr>
                <div class="table table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <th>Entidade</th>
                            <th>json</th>
                            <th class="text-center">crdate</th>
                        </thead>
                        <tbody>
                            <% entities=payload.entities; for(let entity in entities){ // flush %>
                                <tr class="tr-<%=entities[entity].name%>">
                                    <td class="td-<%=entities[entity].name%> td-name">
                                        <%=entities[entity].name.toUpperCase()%>
                                    </td>
                                    <td class="td-<%=entities[entity].name%> td-json">
                                        <a href="#" id="a-<%=entities[entity].name%>" data-bs-toggle="modal"
                                            data-bs-target="#modalFull">/config/entities/<%=entities[entity].json%></a>
                                    </td>
                                    <td class="td-<%=entities[entity].name%> td-crdate">
                                        <div class="text-center">
                                            <div class="spinner-grow spinner-grow-sm text-danger" role="status">
                                                <span class="visually-hidden">Checando...</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <% }; // flush %>
                        </tbody>
                    </table>
                    <% }; // flush %>
                </div>
            </div>
            <script>

                let entity = meta['entities'].content.split(',')
                    , delegateTarget

                for (let name in entity) {

                    document.getElementById(`a-${entity[name]}`).addEventListener('click', (element) => {

                        delegateTarget = element.delegateTarget

                        const payload = {

                            "entity": entity[name],
                            "module": "build"
                        
                        }
                            , method = 'post'
                            
                            controller.then = (socket, incomming) => {

                                console.log(incomming);

                            }

                        call(method, payload, controller)

                    })
                }
            </script>
            <% // flush includes/v1/adm-inc.ejs into ../pages/adm.ejs %>